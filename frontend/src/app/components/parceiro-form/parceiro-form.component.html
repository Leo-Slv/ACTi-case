<div class="header">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <span class="acti-logo">ACTi</span> - Cadastro de Parceiros
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <!-- Alertas de sucesso/erro -->
      <div *ngIf="showSuccess" class="alert success-alert alert-dismissible fade show" role="alert">
        <strong>Sucesso!</strong> Parceiro cadastrado com sucesso.
        <button type="button" class="btn-close" (click)="showSuccess = false"></button>
      </div>
      
      <div *ngIf="showError" class="alert error-alert alert-dismissible fade show" role="alert">
        <strong>Erro!</strong> {{errorMessage}}
        <button type="button" class="btn-close" (click)="showError = false"></button>
      </div>

      <div class="card">
        <div class="card-header">
          Dados do Parceiro
        </div>
        <div class="card-body">
          <form [formGroup]="parceiroForm" (ngSubmit)="onSubmit()" novalidate>
            <!-- Personalidade -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="personalityType" class="form-label">Personalidade *</label>
                <select class="form-select" id="personalityType" 
                        formControlName="personalityType"
                        [ngClass]="{'input-error': parceiroForm.get('personalityType')?.invalid && parceiroForm.get('personalityType')?.touched}">
                  <option value="">Selecione...</option>
                  <option value="F">Pessoa Física</option>
                  <option value="J">Pessoa Jurídica</option>
                </select>
                <div class="error-message" *ngIf="parceiroForm.get('personalityType')?.invalid && parceiroForm.get('personalityType')?.touched">
                  Personalidade é obrigatória.
                </div>
              </div>
              <div class="col-md-6">
                <label for="document" class="form-label" *ngIf="parceiroForm.get('personalityType')?.value === 'F'">CPF *</label>
                <label for="document" class="form-label" *ngIf="parceiroForm.get('personalityType')?.value === 'J'">CNPJ *</label>
                <label for="document" class="form-label" *ngIf="!parceiroForm.get('personalityType')?.value">Documento *</label>
                <input type="text" class="form-control" id="document" 
                       formControlName="document"
                       (blur)="consultarDocumento()"
                       [ngClass]="{'input-error': (parceiroForm.get('document')?.invalid && parceiroForm.get('document')?.touched) || documentoInvalido}"
                       [appMask]="parceiroForm.get('personalityType')?.value === 'F' ? 'cpf' : 'cnpj'">
                <div class="error-message" *ngIf="parceiroForm.get('document')?.invalid && parceiroForm.get('document')?.touched">
                  <span *ngIf="parceiroForm.get('personalityType')?.value === 'F'">CPF é obrigatório.</span>
                  <span *ngIf="parceiroForm.get('personalityType')?.value === 'J'">CNPJ é obrigatório.</span>
                  <span *ngIf="!parceiroForm.get('personalityType')?.value">Documento é obrigatório.</span>
                </div>
                <div class="error-message" *ngIf="documentoInvalido">
                  <span *ngIf="parceiroForm.get('personalityType')?.value === 'F'">CPF inválido.</span>
                  <span *ngIf="parceiroForm.get('personalityType')?.value === 'J'">CNPJ inválido.</span>
                </div>
              </div>
            </div>

            <!-- Razão Social -->
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="companyName" class="form-label">Razão Social *</label>
                <input type="text" class="form-control" id="companyName" 
                       formControlName="companyName"
                       [ngClass]="{'input-error': parceiroForm.get('companyName')?.invalid && parceiroForm.get('companyName')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('companyName')?.invalid && parceiroForm.get('companyName')?.touched">
                  Razão Social é obrigatória.
                </div>
              </div>
            </div>

            <!-- CEP e Telefone -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="zipCode" class="form-label">CEP *</label>
                <input type="text" class="form-control" id="zipCode" 
                       formControlName="zipCode"
                       (blur)="consultarCep()"
                       [ngClass]="{'input-error': (parceiroForm.get('zipCode')?.invalid && parceiroForm.get('zipCode')?.touched) || cepInvalido}"
                       appMask="cep">
                <div class="error-message" *ngIf="parceiroForm.get('zipCode')?.invalid && parceiroForm.get('zipCode')?.touched">
                  CEP é obrigatório.
                </div>
                <div class="error-message" *ngIf="cepInvalido">
                  CEP inválido.
                </div>
              </div>
              <div class="col-md-6">
                <label for="phone" class="form-label">Telefone *</label>
                <input type="text" class="form-control" id="phone" 
                       formControlName="phone"
                       [ngClass]="{'input-error': parceiroForm.get('phone')?.invalid && parceiroForm.get('phone')?.touched}"
                       appMask="telefone">
                <div class="error-message" *ngIf="parceiroForm.get('phone')?.invalid && parceiroForm.get('phone')?.touched">
                  Telefone é obrigatório.
                </div>
              </div>
            </div>

            <!-- Endereço -->
            <div class="row mb-3">
              <div class="col-md-8">
                <label for="street" class="form-label">Logradouro *</label>
                <input type="text" class="form-control" id="street" 
                       formControlName="street"
                       [ngClass]="{'input-error': parceiroForm.get('street')?.invalid && parceiroForm.get('street')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('street')?.invalid && parceiroForm.get('street')?.touched">
                  Logradouro é obrigatório.
                </div>
              </div>
              <div class="col-md-4">
                <label for="number" class="form-label">Número *</label>
                <input type="text" class="form-control" id="number" 
                       formControlName="number"
                       [ngClass]="{'input-error': parceiroForm.get('number')?.invalid && parceiroForm.get('number')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('number')?.invalid && parceiroForm.get('number')?.touched">
                  Número é obrigatório.
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="neighborhood" class="form-label">Bairro *</label>
                <input type="text" class="form-control" id="neighborhood" 
                       formControlName="neighborhood"
                       [ngClass]="{'input-error': parceiroForm.get('neighborhood')?.invalid && parceiroForm.get('neighborhood')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('neighborhood')?.invalid && parceiroForm.get('neighborhood')?.touched">
                  Bairro é obrigatório.
                </div>
              </div>
              <div class="col-md-6">
                <label for="complement" class="form-label">Complemento</label>
                <input type="text" class="form-control" id="complement" 
                       formControlName="complement">
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="city" class="form-label">Município *</label>
                <input type="text" class="form-control" id="city" 
                       formControlName="city"
                       [ngClass]="{'input-error': parceiroForm.get('city')?.invalid && parceiroForm.get('city')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('city')?.invalid && parceiroForm.get('city')?.touched">
                  Município é obrigatório.
                </div>
              </div>
              <div class="col-md-6">
                <label for="state" class="form-label">UF *</label>
                <input type="text" class="form-control" id="state" 
                       formControlName="state"
                       [ngClass]="{'input-error': parceiroForm.get('state')?.invalid && parceiroForm.get('state')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('state')?.invalid && parceiroForm.get('state')?.touched">
                  UF é obrigatória.
                </div>
              </div>
            </div>

            <!-- Email e Observação -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="email" class="form-label">E-mail *</label>
                <input type="email" class="form-control" id="email" 
                       formControlName="email"
                       [ngClass]="{'input-error': parceiroForm.get('email')?.invalid && parceiroForm.get('email')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('email')?.invalid && parceiroForm.get('email')?.touched">
                  <span *ngIf="parceiroForm.get('email')?.errors?.['required']">E-mail é obrigatório.</span>
                  <span *ngIf="parceiroForm.get('email')?.errors?.['email']">E-mail inválido.</span>
                </div>
              </div>
              <div class="col-md-6">
                <label for="observation" class="form-label">Observação</label>
                <textarea class="form-control" id="observation" 
                          formControlName="observation" rows="3"></textarea>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-md-12 d-flex justify-content-end">
                <button type="submit" class="btn btn-acti" [disabled]="loading">
                  <span *ngIf="!loading">Cadastrar</span>
                  <span *ngIf="loading" class="loading"></span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>