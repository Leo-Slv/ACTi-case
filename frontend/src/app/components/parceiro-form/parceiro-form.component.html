<div class="header">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <span class="acti-logo">ACTi</span> - Cadastro de Parceiros
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <!-- Alertas de sucesso/erro -->
      <div *ngIf="showSuccess" class="alert success-alert alert-dismissible fade show" role="alert">
        <strong>Sucesso!</strong> Parceiro cadastrado com sucesso.
        <button type="button" class="btn-close" (click)="showSuccess = false"></button>
      </div>
      
      <div *ngIf="showError" class="alert error-alert alert-dismissible fade show" role="alert">
        <strong>Erro!</strong> {{errorMessage}}
        <button type="button" class="btn-close" (click)="showError = false"></button>
      </div>

      <div class="card">
        <div class="card-header">
          Dados do Parceiro
        </div>
        <div class="card-body">
          <form [formGroup]="parceiroForm" (ngSubmit)="onSubmit()" novalidate>
            <!-- Personalidade -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="personalidade" class="form-label">Personalidade *</label>
                <select class="form-select" id="personalidade" 
                        formControlName="personalidade"
                        [ngClass]="{'input-error': parceiroForm.get('personalidade')?.invalid && parceiroForm.get('personalidade')?.touched}">
                  <option value="">Selecione...</option>
                  <option value="F">Pessoa Física</option>
                  <option value="J">Pessoa Jurídica</option>
                </select>
                <div class="error-message" *ngIf="parceiroForm.get('personalidade')?.invalid && parceiroForm.get('personalidade')?.touched">
                  Personalidade é obrigatória.
                </div>
              </div>
              <div class="col-md-6">
                <label for="cnpjCpf" class="form-label" *ngIf="parceiroForm.get('personalidade')?.value === 'F'">CPF *</label>
                <label for="cnpjCpf" class="form-label" *ngIf="parceiroForm.get('personalidade')?.value === 'J'">CNPJ *</label>
                <label for="cnpjCpf" class="form-label" *ngIf="!parceiroForm.get('personalidade')?.value">Documento *</label>
                <input type="text" class="form-control" id="cnpjCpf" 
                       formControlName="cnpjCpf"
                       (blur)="consultarDocumento()"
                       [ngClass]="{'input-error': (parceiroForm.get('cnpjCpf')?.invalid && parceiroForm.get('cnpjCpf')?.touched) || documentoInvalido}"
                       [appMask]="parceiroForm.get('personalidade')?.value === 'F' ? 'cpf' : 'cnpj'">
                <div class="error-message" *ngIf="parceiroForm.get('cnpjCpf')?.invalid && parceiroForm.get('cnpjCpf')?.touched">
                  <span *ngIf="parceiroForm.get('personalidade')?.value === 'F'">CPF é obrigatório.</span>
                  <span *ngIf="parceiroForm.get('personalidade')?.value === 'J'">CNPJ é obrigatório.</span>
                  <span *ngIf="!parceiroForm.get('personalidade')?.value">Documento é obrigatório.</span>
                </div>
                <div class="error-message" *ngIf="documentoInvalido">
                  <span *ngIf="parceiroForm.get('personalidade')?.value === 'F'">CPF inválido.</span>
                  <span *ngIf="parceiroForm.get('personalidade')?.value === 'J'">CNPJ inválido.</span>
                </div>
              </div>
            </div>

            <!-- Razão Social -->
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="razaoSocial" class="form-label">Razão Social *</label>
                <input type="text" class="form-control" id="razaoSocial" 
                       formControlName="razaoSocial"
                       [ngClass]="{'input-error': parceiroForm.get('razaoSocial')?.invalid && parceiroForm.get('razaoSocial')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('razaoSocial')?.invalid && parceiroForm.get('razaoSocial')?.touched">
                  Razão Social é obrigatória.
                </div>
              </div>
            </div>

            <!-- CEP e Telefone -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="cep" class="form-label">CEP *</label>
                <input type="text" class="form-control" id="cep" 
                       formControlName="cep"
                       (blur)="consultarCep()"
                       [ngClass]="{'input-error': (parceiroForm.get('cep')?.invalid && parceiroForm.get('cep')?.touched) || cepInvalido}"
                       appMask="cep">
                <div class="error-message" *ngIf="parceiroForm.get('cep')?.invalid && parceiroForm.get('cep')?.touched">
                  CEP é obrigatório.
                </div>
                <div class="error-message" *ngIf="cepInvalido">
                  CEP inválido.
                </div>
              </div>
              <div class="col-md-6">
                <label for="telefone" class="form-label">Telefone *</label>
                <input type="text" class="form-control" id="telefone" 
                       formControlName="telefone"
                       [ngClass]="{'input-error': parceiroForm.get('telefone')?.invalid && parceiroForm.get('telefone')?.touched}"
                       appMask="telefone">
                <div class="error-message" *ngIf="parceiroForm.get('telefone')?.invalid && parceiroForm.get('telefone')?.touched">
                  Telefone é obrigatório.
                </div>
              </div>
            </div>

            <!-- Endereço -->
            <div class="row mb-3">
              <div class="col-md-8">
                <label for="logradouro" class="form-label">Logradouro *</label>
                <input type="text" class="form-control" id="logradouro" 
                       formControlName="logradouro"
                       [ngClass]="{'input-error': parceiroForm.get('logradouro')?.invalid && parceiroForm.get('logradouro')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('logradouro')?.invalid && parceiroForm.get('logradouro')?.touched">
                  Logradouro é obrigatório.
                </div>
              </div>
              <div class="col-md-4">
                <label for="numero" class="form-label">Número *</label>
                <input type="text" class="form-control" id="numero" 
                       formControlName="numero"
                       [ngClass]="{'input-error': parceiroForm.get('numero')?.invalid && parceiroForm.get('numero')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('numero')?.invalid && parceiroForm.get('numero')?.touched">
                  Número é obrigatório.
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="bairro" class="form-label">Bairro *</label>
                <input type="text" class="form-control" id="bairro" 
                       formControlName="bairro"
                       [ngClass]="{'input-error': parceiroForm.get('bairro')?.invalid && parceiroForm.get('bairro')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('bairro')?.invalid && parceiroForm.get('bairro')?.touched">
                  Bairro é obrigatório.
                </div>
              </div>
              <div class="col-md-6">
                <label for="complemento" class="form-label">Complemento</label>
                <input type="text" class="form-control" id="complemento" 
                       formControlName="complemento">
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="municipio" class="form-label">Município *</label>
                <input type="text" class="form-control" id="municipio" 
                       formControlName="municipio"
                       [ngClass]="{'input-error': parceiroForm.get('municipio')?.invalid && parceiroForm.get('municipio')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('municipio')?.invalid && parceiroForm.get('municipio')?.touched">
                  Município é obrigatório.
                </div>
              </div>
              <div class="col-md-6">
                <label for="uf" class="form-label">UF *</label>
                <input type="text" class="form-control" id="uf" 
                       formControlName="uf"
                       [ngClass]="{'input-error': parceiroForm.get('uf')?.invalid && parceiroForm.get('uf')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('uf')?.invalid && parceiroForm.get('uf')?.touched">
                  UF é obrigatória.
                </div>
              </div>
            </div>

            <!-- Email e Observação -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="email" class="form-label">E-mail *</label>
                <input type="email" class="form-control" id="email" 
                       formControlName="email"
                       [ngClass]="{'input-error': parceiroForm.get('email')?.invalid && parceiroForm.get('email')?.touched}">
                <div class="error-message" *ngIf="parceiroForm.get('email')?.invalid && parceiroForm.get('email')?.touched">
                  <span *ngIf="parceiroForm.get('email')?.errors?.['required']">E-mail é obrigatório.</span>
                  <span *ngIf="parceiroForm.get('email')?.errors?.['email']">E-mail inválido.</span>
                </div>
              </div>
              <div class="col-md-6">
                <label for="observacao" class="form-label">Observação</label>
                <textarea class="form-control" id="observacao" 
                          formControlName="observacao" rows="3"></textarea>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-md-12 d-flex justify-content-end">
                <button type="submit" class="btn btn-acti" [disabled]="loading">
                  <span *ngIf="!loading">Cadastrar</span>
                  <span *ngIf="loading" class="loading"></span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>